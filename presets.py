"""
尺寸预设配置文件 - 完整版
包含完整的FLUX大尺寸预设和智能尺寸管理
"""
from enum import Enum
from typing import Dict, List, Tuple, Optional, Any

class CropMethod(str, Enum):
    CENTER = "中心裁剪"
    STRETCH = "直接缩放"

class ResizeAlgorithm(str, Enum):
    LANCZOS = "lanczos"
    BILINEAR = "bilinear"
    NEAREST = "nearest"

# 完整的尺寸预设
FLUX_PRESETS = [
    # --- 基础尺寸 ---
    ("1024×1024 (1:1)", (1024, 1024)),
    ("1280×720 (16:9)", (1280, 720)),
    ("720×1280 (9:16)", (720, 1280)),
    ("1536×640 (12:5)", (1536, 640)),
    ("640×1536 (5:12)", (640, 1536)),
    
    # --- 2K分辨率系列 ---
    ("1920×1080 (16:9) 2K", (1920, 1080)),
    ("1080×1920 (9:16) 2K竖版", (1080, 1920)),
    ("2048×1080 (17:9) 2K DCI", (2048, 1080)),
    ("1920×1280 (3:2) 2K", (1920, 1280)),
    ("1280×1920 (2:3) 2K竖版", (1280, 1920)),
    ("2048×1152 (16:9) 2K+", (2048, 1152)),
    ("1152×2048 (9:16) 2K+竖版", (1152, 2048)),
    
    # --- 2.5K分辨率系列 ---
    ("2560×1440 (16:9) 2.5K", (2560, 1440)),
    ("1440×2560 (9:16) 2.5K竖版", (1440, 2560)),
    ("2560×1600 (16:10) 2.5K", (2560, 1600)),
    ("1600×2560 (10:16) 2.5K竖版", (1600, 2560)),
    
    # --- 3K分辨率系列 ---
    ("3072×1728 (16:9) 3K", (3072, 1728)),
    ("1728×3072 (9:16) 3K竖版", (1728, 3072)),
    ("3200×1800 (16:9) 3K+", (3200, 1800)),
    ("1800×3200 (9:16) 3K+竖版", (1800, 3200)),
    
    # --- 4K分辨率系列 ---
    ("3840×2160 (16:9) 4K UHD", (3840, 2160)),
    ("2160×3840 (9:16) 4K竖版", (2160, 3840)),
    ("4096×2160 (17:9) 4K DCI", (4096, 2160)),
    ("2160×4096 (9:17) 4K竖版", (2160, 4096)),
    
    # --- 超大尺寸 ---
    ("5120×2880 (16:9) 5K", (5120, 2880)),
    ("2880×5120 (9:16) 5K竖版", (2880, 5120)),
    ("6144×3456 (16:9) 6K", (6144, 3456)),
    ("3456×6144 (9:16) 6K竖版", (3456, 6144)),
    
    # --- 特殊比例 ---
    ("1366×768 (16:9) 笔记本", (1366, 768)),
    ("768×1366 (9:16) 笔记本竖版", (768, 1366)),
    ("1600×900 (16:9)", (1600, 900)),
    ("900×1600 (9:16)", (900, 1600)),
    ("2560×1080 (21:9) 超宽屏", (2560, 1080)),
    ("3440×1440 (21:9) 超宽屏", (3440, 1440)),
    ("5120×2160 (21:9) 5K超宽屏", (5120, 2160)),
]

# 按类别组织的预设
PRESETS = {
    "SD1.5": [
        ("512×512 (1:1)", (512, 512)),
        ("768×512 (3:2)", (768, 512)),
        ("512×768 (2:3)", (512, 768)),
        ("768×576 (4:3)", (768, 576)),
        ("576×768 (3:4)", (576, 768)),
    ],
    "SDXL": [
        ("1024×1024 (1:1)", (1024, 1024)),
        ("1152×896 (9:7)", (1152, 896)),
        ("896×1152 (7:9)", (896, 1152)),
        ("1344×768 (7:4)", (1344, 768)),
        ("768×1344 (4:7)", (768, 1344)),
        ("1216×832 (19:13)", (1216, 832)),
        ("832×1216 (13:19)", (832, 1216)),
        ("1280×768 (5:3)", (1280, 768)),
        ("768×1280 (3:5)", (768, 1280)),
        ("1536×640 (12:5)", (1536, 640)),
        ("640×1536 (5:12)", (640, 1536)),
        ("1600×640 (5:2)", (1600, 640)),
        ("640×1600 (2:5)", (640, 1600)),
    ],
    "FLUX": FLUX_PRESETS,
    "WAN": [
        ("832×480 (16:9)", (832, 480)),
        ("480×832 (9:16)", (480, 832)),
        ("896×512 (7:4)", (896, 512)),
        ("512×896 (4:7)", (512, 896)),
        ("1280×720 (16:9)", (1280, 720)),
        ("720×1280 (9:16)", (720, 1280)),
        ("640×480 (4:3)", (640, 480)),
        ("960×720 (4:3)", (960, 720)),
        ("480×640 (3:4)", (480, 640)),
        ("720×960 (3:4)", (720, 960)),
        ("720×720 (1:1)", (720, 720)),
        ("480×480 (1:1)", (480, 480)),
        ("1024×576 (16:9)", (1024, 576)),
        ("576×1024 (9:16)", (576, 1024)),
    ],
    "QWEN": [
        ("1328×1328 (1:1)", (1328, 1328)),
        ("928×1664 (9:16)", (928, 1664)),
        ("1664×928 (16:9)", (1664, 928)),
        ("1104×1472 (3:4)", (1104, 1472)),
        ("1472×1104 (4:3)", (1472, 1104)),
        ("1056×1584 (2:3)", (1056, 1584)),
        ("1584×1056 (3:2)", (1584, 1056)),
    ],
    "自定义": [
        ("自定义 768×1024 (3:4)", (768, 1024)),
        ("自定义 1024×768 (4:3)", (1024, 768)),
        ("自定义 1200×1200 (1:1)", (1200, 1200)),
        ("自定义 1440×1440 (1:1)", (1440, 1440)),
        ("自定义 1600×1200 (4:3)", (1600, 1200)),
        ("自定义 1200×1600 (3:4)", (1200, 1600)),
    ],
}

CROP_METHODS = [method.value for method in CropMethod]
RESIZE_ALGOS = [algo.value for algo in ResizeAlgorithm]

def get_size_from_preset(choices: dict) -> Tuple[int, int]:
    """根据选择的预设获取尺寸"""
    for k, v in choices.items():
        if v != "关":
            for name, wh in PRESETS.get(k, []):
                if name == v:
                    return wh
    return (512, 512)